<section class="content">
現状ではWaveが1つしかありません。これを5つまで増やし、更にスコアを実装します。
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/finish_1.png" alt="" />
</div>

<h2><a id="h12-1"></a>12.1　Waveの作成</h2>
Waveをさらに4つ増やします。<a href="./07.html" class="link">第07回</a>で作成したWaveプレハブを複製したものを改良していきます。Waveのエネミーの配置は同じにしなくても問題ありません。例として4つのWaveを紹介します。
 <p><section class="ss12" id="ss12"><a class="blue-btn" href="./project/Wave.unitypackage">Wave.unitypackageをダウンロード</a></section></p>

<h3><a id="h12-1-1"></a>Wave 2</h3>
弾を打たない、HPが4の大量のエネミー
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/wave_2.png" alt="" />
</div>

<h3><a id="h12-1-2"></a>Wave 3</h3>
弾を撃つ、HP10のエネミー
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/wave_3.png" alt="" />
</div>

<h3><a id="h12-1-3"></a>Wave 4</h3>
左右から登場する弾を撃つ、HP10のエネミー
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/wave_4.png" alt="" />
</div>

<h3><a id="h12-1-4"></a>Wave 5</h3>
大きさが3倍で、弾を一度に大量に撃つ、HP100のエネミー
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/wave_5.png" alt="" />
</div>
作成できたら<b>Emitter</b>ゲームオブジェクトをクリックし、インスペクターのWavesへドラッグ＆ドロップしてWaveを追加します。
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/drag_emitter.png" alt="" />
</div>
ゲームを再生してみましょう。Wave → Wave 2 → Wave 3 → Wave 4 → Wave 5 → Wave ... と延々とループしているはずです。
少し難しいと感じたら自分で難易度を調整してみましょう。エネミーのHPや向きや移動スピード、ShotPositionゲームオブジェクトの増減で調整可能です。

<h2><a id="h12-2"></a>12.2　スコアの実装</h2>
最後の要素として「スコア」を実装します。
今回はゲーム中に獲得した現在のスコアと、今までのハイスコアを実装します。

<h3><a id="h12-2-1"></a>スコアの表示</h3>
スコアを画面に表示するためにGUITextを配置します。
<b>空のゲームオブジェクト</b>を作成し、名前を<b>Score GUI</b>としましょう。Transformの<b>Positionは X 0 Y 0 Z 0</b>にしてください。
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/create_score_gameobject.png" alt="" />
</div>
Hierarchyウィンドウの<b>Create</b>ボタンをクリックして<b>GUI Text</b>を選択してください。GUI Textコンポーネントが付いたゲームオブジェクトが作成されます。
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/create_guitext.png" alt="" />
</div>
同じものをもう１つ作成し、<b>Score GUI</b>の子要素とします。そして、名前を<b>Score</b>と<b>HighScore</b>にしましょう。
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/rename.png" alt="" />
</div>
<b>Score</b>と<b>HighScore</b>の設定を行います。
<b>TransformのPosition</b>、<b>GUITextのText</b>、<b>Anchor</b>、<b>Font</b>、<b>Font Size</b>を図12.1と図12.2を見ながら設定しましょう。
<div style='display:flex'>
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/score.png" alt="" width="90%" />
<p class="caption">
図12.1: 
</p>
</div>
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/highscore.png" alt="" width="90%" />
<p class="caption">
図12.2: 
</p>
</div>
</div>
正しく設定を行うと図12.3のようにゲームビューの右上と右下に<b>0</b>と表示が行われます。
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/correct_view.png" alt="" />
<p class="caption">
図12.3: 
</p>
</div>

<h3><a id="h12-2-2"></a>スクリプトの作成</h3>
<b>Score.cs</b>を<b>Scripts</b>フォルダ配下に作成してください。
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/create_score_script.png" alt="" />
</div>
今回、スコアの保存は<tt class="inline-code">PlayerPrefs</tt>クラスを使用して保存します。
<div class="column">

<h3><a id="column-32"></a>PlayerPrefs</h3>
このクラスはゲームで保存しておきたいデータを保存するためのクラスです。
例えばゲームの進行度やサウンドのボリューム、ハイスコア、ランキング、などはPlayerPrefsでデータを保持することで実現できます。
細かな制限もあるので、詳しくはドキュメントの<a href="//docs-jp.unity3d.com/Documentation/ScriptReference/PlayerPrefs.html" class="link">PlayerPrefs</a>を御覧ください。
</div>
<div class="source-code">
<p class="caption">Score.cs</p>
<pre class="source">using UnityEngine;

public class Score : MonoBehaviour
{
        // スコアを表示するGUIText
        public GUIText scoreGUIText;

        // ハイスコアを表示するGUIText
        public GUIText highScoreGUIText;

        // スコア
        private int score;

        // ハイスコア
        private int highScore;

        // PlayerPrefsで保存するためのキー
        private string highScoreKey = &quot;highScore&quot;;

        void Start ()
        {
                Initialize ();
        }

        void Update ()
        {
                // スコアがハイスコアより大きければ
                if (highScore &lt; score) {
                        highScore = score;
                }

                // スコア・ハイスコアを表示する
                scoreGUIText.text = score.ToString ();
                highScoreGUIText.text = &quot;HighScore : &quot; + highScore.ToString ();
        }

        // ゲーム開始前の状態に戻す
        private void Initialize ()
        {
                // スコアを0に戻す
                score = 0;

                // ハイスコアを取得する。保存されてなければ0を取得する。
                highScore = PlayerPrefs.GetInt (highScoreKey, 0);
        }

        // ポイントの追加
        public void AddPoint (int point)
        {
                score = score + point;
        }

        // ハイスコアの保存
        public void Save ()
        {
                // ハイスコアを保存する
                PlayerPrefs.SetInt (highScoreKey, highScore);
                PlayerPrefs.Save ();

                // ゲーム開始前の状態に戻す
                Initialize ();
        }
}
</pre>
</div>
作成した<b>Score.cs</b>を<b>Score GUI</b>ゲームオブジェクトにドラッグ＆ドロップしてください。
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/drag_score_script.png" alt="" />
</div>
インスペクターの<b>Score GUIText</b>と<b>High Score GUIText</b>に<b>Score</b>ゲームオブジェクトと<b>HighScore</b>ゲームオブジェクトをそれぞれドラッグ＆ドロップします。
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/drag_score_and_highscore.png" alt="" />
</div>
これでスコアを表示する準備が出来ました。次はスコアのポイントを追加していく処理を実装していきます。

<h3><a id="h12-2-3"></a>エネミーにポイントを持たせる</h3>
エネミーを倒したらポイントを追加していきます。そのために<b>Enemy.cs</b>にポイントを保持する変数を加えましょう。
そして、OnTriggerEnter2Dメソッド内で爆発する時にスコアにポイントを追加する処理を追加します。
<div class="source-code">
<p class="caption">Enemy.cs</p>
<pre class="source">using UnityEngine;
using System.Collections;

public class Enemy : MonoBehaviour
{
        // ヒットポイント
        public int hp = 1;

        // スコアのポイント
        public int point = 100;

        // Spaceshipコンポーネント
        Spaceship spaceship;

        IEnumerator Start ()
        {

                // Spaceshipコンポーネントを取得
                spaceship = GetComponent&lt;Spaceship&gt; ();

                // ローカル座標のY軸のマイナス方向に移動する
                Move (transform.up * -1);

                // canShotがfalseの場合、ここでコルーチンを終了させる
                if (spaceship.canShot == false) {
                        yield break;
                }

                while (true) {

                        // 子要素を全て取得する
                        for (int i = 0; i &lt; transform.childCount; i++) {

                                Transform shotPosition = transform.GetChild (i);

                                // ShotPositionの位置/角度で弾を撃つ
                                spaceship.Shot (shotPosition);
                        }

                        // shotDelay秒待つ
                        yield return new WaitForSeconds (spaceship.shotDelay);
                }
        }

        // 機体の移動
        public void Move (Vector2 direction)
        {
                rigidbody2D.velocity = direction * spaceship.speed;
        }

        void OnTriggerEnter2D (Collider2D c)
        {
                // レイヤー名を取得
                string layerName = LayerMask.LayerToName (c.gameObject.layer);

                // レイヤー名がBullet (Player)以外の時は何も行わない
                if (layerName != &quot;Bullet (Player)&quot;) return;

                // PlayerBulletのTransformを取得
                Transform playerBulletTransform = c.transform.parent;

                // Bulletコンポーネントを取得
                Bullet bullet =  playerBulletTransform.GetComponent&lt;Bullet&gt;();

                // ヒットポイントを減らす
                hp = hp - bullet.power;

                // 弾の削除
                Destroy(c.gameObject);

                // ヒットポイントが0以下であれば
                if(hp &lt;= 0 )
                {
                        // スコアコンポーネントを取得してポイントを追加
                        FindObjectOfType&lt;Score&gt;().AddPoint(point);

                        // 爆発
                        spaceship.Explosion ();

                        // エネミーの削除
                        Destroy (gameObject);

                }else{

                        spaceship.GetAnimator().SetTrigger(&quot;Damage&quot;);

                }
        }
}
</pre>
</div>
それぞれのWaveプレハブ内にあるEnemyでポイントを調整します。HPが高いほど高得点にしたり、難易度によって得点を変化させてみましょう。
<div style='display:flex'>
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/point_100.png" alt="" width="90%" />
</div>
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/point_200.png" alt="" width="90%" />
</div>
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/point_2000.png" alt="" width="90%" />
</div>
</div>
ゲームを再生してみましょう。敵を倒すとスコアにポイントが加算され、ハイスコアを更新すれば右下のハイスコアがリアルタイムで更新されていきます。
<div class="image">
<img src="wp-content/uploads/2d-shooting-game/game/images/12/finish_2.png" alt="" />
</div>

<h3><a id="h12-2-4"></a>ハイスコアの保存</h3>
最後にゲームオーバーの時にハイスコアを保存するようにします。
Manager.csのGameOverメソッドに追記します。
<div class="source-code">
<p class="caption">Manager.cs</p>
<pre class="source">using UnityEngine;

public class Manager : MonoBehaviour
{
        // Playerプレハブ
        public GameObject player;

        // タイトル
        private GameObject title;

        void Start ()
        {
                // Titleゲームオブジェクトを検索し取得する
                title = GameObject.Find (&quot;Title&quot;);
        }

        void Update ()
        {
                // ゲーム中ではなく、Xキーが押されたらtrueを返す。
                if (IsPlaying () == false &amp;&amp; Input.GetKeyDown (KeyCode.X)) {
                        GameStart ();
                }
        }

        void GameStart ()
        {
                // ゲームスタート時に、タイトルを非表示にしてプレイヤーを作成する
                title.SetActive (false);
                Instantiate (player, player.transform.position, player.transform.rotation);
        }

        public void GameOver ()
        {
                // ハイスコアの保存
                FindObjectOfType&lt;Score&gt;().Save();

                // ゲームオーバー時に、タイトルを表示する
                title.SetActive (true);
        }

        public bool IsPlaying ()
        {
                // ゲーム中かどうかはタイトルの表示/非表示で判断する
                return title.activeSelf == false;
        }
}
</pre>
</div>
お疲れ様でした。ゲーム制作編は以上で終了となります。


    
      <h3>第12回終わり</h3>
      今回はここで終了です。つまずいてしまった方はプロジェクトファイルをダウンロードして新たな気持ちで次の回へ進みましょう。
      <section class="ss12" id="ss12"><a class="blue-btn" href="./project/game_12_ShootingGame.zip">今回のプロジェクトファイルをダウンロード</a></section>
    

</section>